<meta charset="utf-8">
<h1 id="datascience">Как ворваться в Data Science и получить видеокарту от Гугла</h1>

<p>Вы начинающий Data Scientist, посмотревший лекции и разобравшийся с теорией, а теперь жаждущий попрактиковаться, но мощного железа под рукой нет?
Что ж, с помощью инструментов компании Google вы можете начать учить ваши первые нейроные сети уже сейчас!</p>

<p>В этом туториале  я расскажу и покажу, как настроить доступ к сервису Google Cloud Platform и получить мощную видеокарту на целых 10 Терафлопс!</p>

<h2 id="1">Шаг 1 - Найдите</h2>

<p>Найдите сайт google cloud platform
<img src="tutorial/photo1.png" alt="" /></p>

<p>Он выглядит как-то так.
<img src="tutorial/photo2png" alt="" /></p>

<h2 id="2">Шаг 2 - Зарегистрируйтесь</h2>

<p>Зарегистрируйтесь с помощью акаунта Google.
<img src="tutorial/photo3.png" alt="" /></p>

<p>Google предложит вам бесплатные 300$.
<img src="tutorial/photo4.png" alt="" /></p>

<p>Вот это же предложение подробнее.
<img src="tutorial/photo5.png" alt="" /></p>

<p>Вас попросят ввести данные вашей карточки.
<img src="tutorial/photo6.png" alt="" /></p>

<p>Если предложение от Гугла не вылезло, то заходим в раздел «Оплата», где сами создаём платёжный аккаунт. Да, тут точно также дадут 300$ на первое время.<img src="tutorial/photo7.png" alt="" /></p>

<h2 id="3">Шаг 3 - Создайте свое первый инстанс</h2>

<p>Заходим в раздел «Compute Engine» -> Экземпляры ВМ
<img src="tutorial/photo8.png" alt="" /></p>

<p>Создаём проект</p>

<p>После чего заходим в раздел «Квоты», для того, чтобы запросить увеличение квоты по видеокартам. По умолчанию эта квота равна 0.
<img src="tutorial/photo9.png" alt="" /></p>

<p>Ищем квоту по видеокартам NVIDIA. Выбираем себе карточку. Для большинства задач подойдет Tesla K80, её дополнительный плюс в том, что она достаточно дешёвая.
Но я брал себе Tesla P100, Just for fun.</p>

<p>Tesla P100 как раз таки имеет 10 Терафлопс, у K80 их около 2~3.
<img src="tutorial/photo10.png" alt="" /></p>

<p>Далее внимательно выбираем себе регион, советую брать Европу или Азию, в них меньше пинг, в целом, помимо пинга  отличий особо нет.</p>

<p>ВАЖНО! Перед тем, как запрашивать карточку в том или ином регионе надо проверить, доступна ли она вообще для данного региона. </p>

<p>Сделать это можно тут
<a href="https://cloud.google.com/compute/docs/gpus/">GPUs on Compute Engine  |  Compute Engine Documentation       |  Google Cloud</a></p>

<p>Доступные регионы случае с NVIDIA Tesla P100 
<img src="tutorial/photo11.png" alt="" /></p>

<p>Выбираем квоту, нажимаем «Изменить квоты» в верхней части страницы.
<img src="tutorial/photo12.png" alt="" /></p>

<p>Формируем запрос и отправляем его, ответ придет в районе несколько часов.
<img src="tutorial/photo13.png" alt="" /></p>

<p>Выбираем «Создать экземпляр»
<img src="tutorial/photo14.png" alt="" /></p>

<p>Выбираем регион, где вам выделили видеокарту
<img src="tutorial/photo15.png" alt="" /></p>

<p>Жмём «Настроить»
<img src="tutorial/photo16.png" alt="" /></p>

<p>Мой дефолтный setup выглядит как-то так. 4 процессора и 16 Гб оперативки - лучше брать столько или слегка больше, эти ресурсы стоят не так дорого ( на порядок дешевле видеокарты), однако при их нехватке могут возникнуть серьезные подтормаживания. К слову, при тренировке resnet36 все 4 процессора работали на 70-80% и было занято 5~6 Гб оперативной памяти.
<img src="tutorial/photo17.png" alt="" /></p>

<p>Далее выбираем загрузочный диск. Советую брать Ubuntu LTS16, так как на неё более менее спокойно встает Cuda, с 18й же версией у меня возникали проблемы.
По поводу размера не советую сразу брать много, так как за это постоянно списывают деньги, даже когда вы не используете ваш инстанс.
25 Гб для начала более чем достаточно 
<img src="tutorial/photo18.png" alt="" /></p>

<p>Обязательно разрешаем HTTP и HTTPS траффик, чтобы была возможность подключения по ssh.  Создаем экземпляр.</p>

<p>Вуаля, ваш инстанс готов, осталось подключиться к нему и настроить необходимые компоненты</p>

<h2 id="4">Шаг 4 - Подключение</h2>

<p>Одним из вариантов подключения является протокол ssh, сейчас я объясню, как настроить ваш инстанс для работы по ssh.</p>

<p>Для начала генерируем пару ключей на вашем рабочем компьютере с помощью следующей комманды</p>

<pre><code class="  language- ">ssh-keygen
</code></pre>

<p>Можно задать вашему ключу любое имя и хранить его в любом месте. Пункт «Passphrase» нужен для дополнительной защиты ключа, его можно пропустить.
<img src="tutorial/photo19.png" alt="" /></p>

<p>После генерации пары ключей нам необходимо закинуть публичный ключ на нашу виртуальную машину. А заходить на неё мы будем с помощью нашего приватного ключа.</p>

<p>Зайдем в папку, где мы сохранили ключи.
<img src="tutorial/photo20.png" alt="" /></p>

<p>«.pub» - публичный ключ, открываем его в любом текстовом редакторе и копируем содержимое.</p>

<p><img src="tutorial/photo21.png" alt="" /></p>

<p>Это будет выглядеть как-то так.
<img src="tutorial/photo22.png" alt="" /></p>

<p>После чего, нажимая на имя нашего инстанса, мы открываем настройку его параметров.
Пролистывая вниз находим пункт «SSH-ключи». 
Вставляем публичный ключ сюда. При желании, изменив последнюю строчку публичного ключа до @ можно поменять имя пользователя.
<img src="tutorial/photo23.png" alt="" /></p>

<p>Сохраняем изменения и запускаем виртуальную машину</p>

<p>У запущенной машины появится внешний ip адрес, запомним его.
<img src="tutorial/photo24.png" alt="" /></p>

<p>Далее, пишем в терминале следующую команду:</p>

<pre><code class="  language- ">ssh -i path_to_your_private_key username@ip_addres
</code></pre>

<p>В моем случае это выгляди так:</p>

<pre><code class="  language- ">ssh -i ~/.ssh/cuctom_key_name oak@35.204.41.62
</code></pre>

<p>При подключении могут возникнуть некоторые ошибки или непонятные проишествия, но все они легко гуглятся</p>

<p>Поздравляю вы подключились к вашему первому серверу!</p>

<h2 id="5">Шаг 5 - немного настройки</h2>

<p>Если вы занимаетесь Data Science, то вам будет необходимо поставить Anaconda и Cuda</p>

<p>Anaconda установить достаточно просто, а как установить CUDA можно почитать тут: 
<a href="https://developer.nvidia.com/cuda-90-download-archive?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=Ubuntu&amp;target_version=1604&amp;target_type=debnetwork">CUDA Toolkit 9.0 Downloads | NVIDIA Developer</a></p>

<p>Если возникают проблемы с запуском jupyter notebook, то стоит установить его через pip и apt-get</p>

<h2 id="6jupyternotebookssh">Шаг 6 - подключение к Jupyter  Notebook  через SSH и прокидывание портов</h2>

<p>Для начала запустим Jupyter Notebook на удаленной машине. Как правило, он уже входит в пакет анаконды, но при необходимости его можно поставить через pip и apt-get.</p>

<p>Советую дополнительно поставить «Tmux» - эта утилита позволит вам запустить Jupyter notebook так, чтобы Егор работа не зависела от shh-сессии, что очень удобно</p>

<p>Пишем  Tmux -  у нас открывается дополнительный терминал, если его так можно назвать.
Пишем следующий код:</p>

<pre><code class="  language- ">jupyter notebook --no-browser --port=BBBB
</code></pre>

<p>«—no-browser» - так как мы запускаем на удаленной машине, без этого флага не запустится</p>

<p>«—port = BBBB» - указываем номер порта, желательно диапазон 8000 - 8100 (наверное, лучше уточнить), любой из диапазона на ваш вкус.</p>

<p>Предварительно необходимо настроить пароль</p>

<pre><code class="  language- ">jupyter notebook --generate-config
jupyter notebook password
</code></pre>

<p>Или можно скопировать токен, который сгенерирует jupyter notebook и затем вставить его в окошко пароля.</p>

<p>Затем нам необходимо прокинуть порт удаленной машины на нашу локальную машину.</p>

<pre><code class="  language- ">ssh -i ~/.ssh/cuctom_key_name -N -f -L AAAA:localhost:BBBB username@server_ip
</code></pre>

<p>Как пример</p>

<pre><code class="  language- ">ssh -i ~/.ssh/cuctom_key_name -N -f -L 8090:localhost:8080 fergus@server_ip
</code></pre>

<p>AAAA - порт на нашей локальной машине, желательно диапазон 8000 - 8100 (наверное, лучше уточнить), любой из диапазона на ваш вкус.</p>

<p>BBBB - порт, который мы указали при запуске jupyter notebook на удаленной машине</p>

<p>Затем заходим в браузер, где пишем localhost:AAAA</p>

<p>Вуаля, дерзайте!</p>

<p>(Перенос стиля, как один из use-case-ов применения нейронных сетей)
<img src="tutorial/photo25.png" alt="" /></p>
